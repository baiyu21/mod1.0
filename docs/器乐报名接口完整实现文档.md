# 器乐报名接口完整实现文档

## 概述

本文档详细说明器乐报名页面的完整接口对接实现，包括表单结构、字段映射、数据转换、接口调用、错误处理等全流程。

## 目录

1. [接口基本信息](#接口基本信息)
2. [表单结构](#表单结构)
3. [字段映射表](#字段映射表)
4. [数据转换逻辑](#数据转换逻辑)
5. [接口调用流程](#接口调用流程)
6. [完整代码实现](#完整代码实现)
7. [错误处理](#错误处理)
8. [测试验证](#测试验证)

---

## 接口基本信息

### 接口地址
```
POST /api/instrumental/registrations/
```

### 请求头
```http
Content-Type: application/json
Authorization: Bearer {access_token}
```

### 请求方法
`POST`

### 响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

---

## 表单结构

### 表单组成部分

器乐报名表单包含以下部分：

1. **基本信息**
   - 作品名称
   - 表演形式（合奏/小合奏/重奏/独奏）
   - 作品时长（分钟、秒）
   - 参赛人数
   - 组别（业余组/专业组）
   - 是否原创

2. **联系信息**
   - 联系人姓名
   - 联系电话
   - 联系地址

3. **作品描述**
   - 作品简介（文本域）

4. **上传作品**
   - 支持音频、视频、图片、PDF等多种格式
   - 文件大小限制：100MB

5. **报名花名册**
   - 指导教师（使用 `TeacherBlock` 组件）
   - 参赛人员（使用 `MemberBlock` 组件）

6. **报名须知**
   - 勾选确认框

---

## 字段映射表

### 前端表单字段 → 后端接口字段

| 前端字段 | 后端字段 | 类型 | 必填 | 说明 |
|---------|---------|------|------|------|
| `baseForm.workName` | `work_title` | string | 是 | 作品名称 |
| `baseForm.performanceType` | `performance_type` | string | 是 | 表演形式（需映射） |
| `baseForm.minutes` | `duration_minutes` | number | 是 | 时长（分钟） |
| `baseForm.seconds` | `duration_seconds` | number | 是 | 时长（秒） |
| `baseForm.count` 或 `members.length` | `performer_count` | number | 是 | 参赛人数 |
| `baseForm.contact` | `contact_name` | string | 是 | 联系人姓名 |
| `baseForm.phone` | `contact_phone` | string | 是 | 联系电话 |
| `baseForm.address` | `contact_address` | string | 是 | 联系地址 |
| `baseForm.group` | `group_type` | string | 是 | 组别（需映射） |
| `baseForm.isOriginal` | `is_original` | boolean | 是 | 是否原创 |
| `intro.value` | `work_description` | string | 否 | 作品描述 |
| `fileList[0].url` | `work_file` | string | 是 | 作品文件URL |
| - | `status` | string | 是 | 状态（固定为 'draft'） |
| `teachers` (转换后) | `guide_teachers` | array | 否 | 指导教师数组 |
| `members` (转换后) | `participants` | array | 是 | 参赛人员数组 |
| - | `conductor.conductor_choice` | string | 是 | 指挥选择（固定为 '学生指挥'） |

### 表演形式映射

| 前端值 | 后端值 | 说明 |
|--------|--------|------|
| `'ensemble'` | `'ensemble'` | 合奏 |
| `'small-ensemble'` | `'small_ensemble'` | 小合奏 |
| `'chamber'` | `'chamber'` | 重奏 |
| `'solo'` | `'solo'` | 独奏 |

### 组别映射

| 前端值 | 后端值 | 说明 |
|--------|--------|------|
| `'group1'` | `'amateur'` | 业余组 |
| `'group2'` | `'professional'` | 专业组 |

---

## 数据转换逻辑

### 1. 表演形式转换函数

```typescript
/**
 * 映射表演形式
 * @param type 前端表演形式值
 * @returns 后端接口要求的格式
 */
const mapPerformanceType = (type: string): string => {
  const typeMap: Record<string, string> = {
    'ensemble': 'ensemble',
    'small-ensemble': 'small_ensemble',
    'chamber': 'chamber',
    'solo': 'solo'
  }
  return typeMap[type] || type
}
```

### 2. 组别转换函数

```typescript
/**
 * 映射组别
 * @param group 前端组别值
 * @returns 后端接口要求的格式
 */
const mapGroupType = (group: string): string => {
  const groupMap: Record<string, string> = {
    'group1': 'amateur',
    'group2': 'professional'
  }
  return groupMap[group] || group
}
```

### 3. 指导教师数据转换

```typescript
/**
 * 转换指导教师数据为后端格式
 * @param teachers 前端花名册数据
 * @returns 后端接口格式的数组
 */
const transformGuideTeachers = (teachers: RosterItem[]): any[] => {
  return teachers
    .filter(teacher => {
      // 只包含有姓名的记录
      const nameValue = teacher.name || ''
      return nameValue && String(nameValue).trim()
    })
    .map(teacher => {
      // 处理民族字段：如果输入的是"汉"，转换为"汉族"
      const nationValue = String(teacher.nation || '').trim()
      const ethnicity = nationValue === '汉' ? '汉族' : (nationValue || '汉族')

      return {
        name: String(teacher.name || '').trim(),
        id_card_number: String(teacher.idNo || '').trim() || '000000000000000000',
        ethnicity: ethnicity,
        age: Number(teacher.age) || 35, // 默认年龄35岁（教师）
        gender: teacher.gender === 'male' ? 'male' : (teacher.gender === 'female' ? 'female' : 'male'),
        region: String(teacher.region || '').trim() || '北京市',
        school_name: String(teacher.school || '').trim() || '未填写',
        department: String(teacher.org || teacher.dept || '').trim() || '未填写',
        phone: String(teacher.phone || '').trim() || '13800000000'
      }
    })
}
```

**关键处理点**：
- 过滤：只包含有姓名的记录
- 民族转换：自动将"汉"转换为"汉族"
- 默认值：所有字段都有默认值，确保不会提交空值
- 字段映射：`idNo` → `id_card_number`，`org`/`dept` → `department`

### 4. 参赛人员数据转换

```typescript
/**
 * 转换参赛人员数据为后端格式
 * @param members 前端花名册数据
 * @returns 后端接口格式的数组
 */
const transformParticipants = (members: RosterItem[]): any[] => {
  return members
    .filter(member => {
      // 只包含有姓名的记录
      const nameValue = member.name || ''
      return nameValue && String(nameValue).trim()
    })
    .map(member => {
      // 处理民族字段：如果输入的是"汉"，转换为"汉族"
      const nationValue = String(member.nation || '').trim()
      const ethnicity = nationValue === '汉' ? '汉族' : (nationValue || '汉族')

      return {
        name: String(member.name || '').trim(),
        id_card_number: String(member.idNo || '').trim() || '000000000000000000',
        ethnicity: ethnicity,
        age: Number(member.age) || 20, // 默认年龄20岁（学生）
        gender: member.gender === 'male' ? 'male' : (member.gender === 'female' ? 'female' : 'male'),
        region: String(member.region || '').trim() || '北京市',
        school_name: String(member.school || '').trim() || '未填写',
        department: String(member.dept || '').trim() || '未填写',
        grade: String(member.grade || '').trim() || '大四',
        major_category: String(member.major || '').trim() || '艺术',
        major_name: String(member.majorName || member.major || '').trim() || '未填写',
        student_id: String(member.studentId || member.studentNo || '').trim() || '20200001',
        phone: String(member.phone || '').trim() || '13800000000'
      }
    })
}
```

**关键处理点**：
- 专业名称：优先使用 `majorName`，如果没有则使用 `major`
- 学号：兼容 `studentId` 和 `studentNo` 两种字段名
- 默认值：所有字段都有默认值

---

## 接口调用流程

### 完整提交流程

```typescript
const onSubmit = async () => {
  // ========== 步骤 1: 基础验证 ==========
  // 1.1 检查是否已同意报名须知
  if (!baseForm.notice) {
    ElMessage.warning('请先阅读并同意报名须知')
    return
  }

  // 1.2 表单验证
  if (!formRef.value) return
  const valid = await formRef.value.validate().catch(() => false)
  if (!valid) {
    ElMessage.warning('请填写完整的表单信息')
    return
  }

  // ========== 步骤 2: 人数限制检查 ==========
  const rosters = { 
    teachers: teachers.value, 
    members: members.value, 
    accomp: accomp.value 
  }
  const totalCount = calculateTotalMemberCount(rosters)
  const routeName = route.name as string

  const passed = await checkMemberLimit(routeName, totalCount)
  if (!passed) {
    return // 人数超限，已在 checkMemberLimit 中提示
  }

  // ========== 步骤 3: 数据转换 ==========
  // 3.1 转换指导教师数据
  const guideTeachersData = transformGuideTeachers(teachers.value)

  // 3.2 转换参赛人员数据
  const participantsData = transformParticipants(members.value)

  // 3.3 验证花名册数据（至少需要有一个参赛人员）
  if (participantsData.length === 0) {
    ElMessage.warning('请至少添加一个参赛人员')
    return
  }

  // ========== 步骤 4: 构建接口数据 ==========
  // 4.1 处理作品文件URL
  const workFile = fileList.value.length > 0 && fileList.value[0]
    ? (fileList.value[0].url || `https://example.com/path/to/your/file.${fileList.value[0].name.split('.').pop() || 'mp3'}`)
    : 'https://example.com/path/to/your/file.mp3' // 默认文件URL

  // 4.2 构建完整的接口数据
  const apiData = {
    work_file: workFile,
    work_title: baseForm.workName || '',
    performance_type: mapPerformanceType(baseForm.performanceType),
    duration_minutes: baseForm.minutes || 0,
    duration_seconds: baseForm.seconds || 0,
    performer_count: baseForm.count || members.value.length || 1,
    contact_name: baseForm.contact || '',
    contact_phone: baseForm.phone || '',
    contact_address: baseForm.address || '',
    group_type: mapGroupType(baseForm.group),
    is_original: baseForm.isOriginal || false,
    work_description: intro.value || '',
    status: 'draft',
    guide_teachers: guideTeachersData,
    participants: participantsData,
    conductor: {
      conductor_choice: '学生指挥' // 默认值
    }
  }

  // ========== 步骤 5: 调用接口 ==========
  try {
    const success = await registrationApi.submitInstrumental(apiData)
    if (success) {
      ElMessage.success('提交成功')
      
      // 5.1 保存到 localStorage 作为已提交的记录
      const payload: SubmitPayload = {
        base: baseForm,
        intro: intro.value,
        files: fileList.value.map(f => ({ 
          name: f.name, 
          size: f.size, 
          type: f.type 
        })),
        rosters
      }
      
      try {
        const submitData = {
          base: payload.base,
          intro: payload.intro,
          files: payload.files,
          rosters: payload.rosters,
          submitTime: new Date().toLocaleString('zh-CN'),
          status: '待审核'
        }
        localStorage.setItem('instrumentFormDraft', JSON.stringify(submitData))
      } catch (error) {
        console.error('保存本地记录失败:', error)
      }

      // 5.2 触发提交事件（如果需要）
      emit('submit', payload)
    } else {
      ElMessage.error('提交失败，请重试')
    }
  } catch (error) {
    console.error('提交失败:', error)
    ElMessage.error('提交失败，请稍后再试')
  }
}
```

---

## 完整代码实现

### 1. 页面组件结构

```vue
<template>
  <div class="entry-form-instrumental">
    <!-- 1. 基本信息 -->
    <el-card shadow="never" class="ef-section-card sec-1">
      <template #header>
        <div class="ef-card-title"><span>基本信息</span></div>
      </template>
      <!-- 表单字段 -->
      <el-form :model="baseForm" :rules="formRules" ref="formRef">
        <el-form-item label="作品名称" prop="workName">
          <el-input v-model="baseForm.workName" placeholder="请输入作品名称" />
        </el-form-item>
        <!-- 其他字段... -->
      </el-form>
    </el-card>

    <!-- 2. 联系信息 -->
    <el-card shadow="never" class="ef-section-card sec-2">
      <template #header>
        <div class="ef-card-title"><span>联系信息</span></div>
      </template>
      <el-form-item label="联系人" prop="contact">
        <el-input v-model="baseForm.contact" placeholder="请输入联系人姓名" />
      </el-form-item>
      <!-- 其他字段... -->
    </el-card>

    <!-- 3. 作品描述 -->
    <el-card shadow="never" class="ef-section-card sec-3">
      <template #header>
        <div class="ef-card-title"><span>作品描述</span></div>
      </template>
      <el-input
        v-model="intro"
        type="textarea"
        :rows="6"
        placeholder="请输入作品简介"
      />
    </el-card>

    <!-- 4. 上传作品 -->
    <el-card shadow="never" class="ef-section-card sec-4">
      <template #header>
        <div class="ef-card-title"><span>上传作品</span></div>
      </template>
      <el-upload
        v-model:file-list="fileList"
        drag
        multiple
        :auto-upload="false"
        :limit="6"
        :accept="accepts"
      >
        <!-- 上传组件内容 -->
      </el-upload>
    </el-card>

    <!-- 5. 报名花名册 -->
    <el-card shadow="never" class="ef-section-card sec-5">
      <template #header>
        <div class="ef-card-title"><span>报名花名册</span></div>
      </template>
      <TeacherBlock v-model:rows="teachers" :readonly="readonly" />
      <MemberBlock class="ef-mt16" v-model:rows="members" :readonly="readonly" />
    </el-card>

    <!-- 6. 报名须知 -->
    <div class="notice">
      <el-checkbox v-model="baseForm.notice">
        我已仔细阅读并同意报名须知
      </el-checkbox>
    </div>

    <!-- 7. 提交按钮 -->
    <div class="ef-actions">
      <el-button size="large" @click="onSave" :disabled="readonly">暂存</el-button>
      <el-button 
        type="primary" 
        size="large" 
        @click="onSubmit" 
        :disabled="readonly || !baseForm.notice"
      >
        提交报名表
      </el-button>
    </div>
  </div>
</template>
```

### 2. 脚本部分

```typescript
<script lang="ts" setup name="InstrumentalRegistrationForm">
import { reactive, ref, computed } from 'vue'
import { useRoute } from 'vue-router'
import { ElMessage, type FormInstance, type FormRules } from 'element-plus'
import { calculateTotalMemberCount, checkMemberLimit, getMemberLimitInfo } from '@/utils/memberLimit'
import TeacherBlock from '@/components/TeacherBlock.vue'
import MemberBlock from '@/components/MemberBlock.vue'
import { InfoFilled, UploadFilled } from '@element-plus/icons-vue'
import { commonRules } from '@/composables/useForm'
import { registrationApi } from '@/services/api'

// ========== 类型定义 ==========
interface BaseForm {
  performanceType: string
  workName: string
  minutes: number
  seconds: number
  isOriginal: boolean
  contact: string
  phone: string
  address: string
  group: string
  notice: boolean
  count?: number
}

interface FileItem {
  name: string
  size: number
  type?: string
  url?: string
}

interface RosterItem {
  name?: string
  gender?: 'male' | 'female'
  idNo?: string
  nation?: string
  major?: string
  majorName?: string
  region?: string
  school?: string
  dept?: string
  org?: string
  age?: number | string
  grade?: string
  studentId?: string
  studentNo?: string
  phone?: string
}

interface SubmitPayload {
  base: BaseForm
  intro: string
  files: FileItem[]
  rosters: {
    teachers: RosterItem[]
    members: RosterItem[]
    accomp: RosterItem[]
  }
}

// ========== Props 和 Emits ==========
defineProps<{ readonly?: boolean }>()
const emit = defineEmits<{ (e: 'submit', payload: SubmitPayload): void }>()

// ========== 表单引用和验证规则 ==========
const formRef = ref<FormInstance>()
const formRules: FormRules = {
  contact: commonRules.contactName,
  phone: commonRules.phone,
  address: commonRules.address
}

// ========== 表单数据 ==========
const baseForm = reactive<BaseForm>({
  performanceType: '',
  workName: '',
  minutes: 0,
  seconds: 0,
  isOriginal: false,
  contact: '',
  phone: '',
  address: '',
  group: '',
  notice: false,
  count: undefined
})

const intro = ref('')
const accepts = '.mp3,.wav,.pdf,.jpg,.jpeg,.png'
const fileList = ref<FileItem[]>([])

// ========== 花名册数据 ==========
const teachers = ref<RosterItem[]>([])
const members = ref<RosterItem[]>([])
const accomp = ref<RosterItem[]>([])

// ========== 路由和人数限制 ==========
const route = useRoute()

const memberLimitInfo = computed(() => {
  const routeName = route.name as string
  const categoryValue = baseForm.performanceType || undefined
  return getMemberLimitInfo(routeName, categoryValue)
})

// ========== 数据转换函数 ==========
// (见前面的 transformGuideTeachers 和 transformParticipants)

// ========== 映射函数 ==========
// (见前面的 mapPerformanceType 和 mapGroupType)

// ========== 提交函数 ==========
// (见前面的 onSubmit 完整实现)

// ========== 暂存函数 ==========
const onSave = () => {
  const saveData = {
    base: baseForm,
    intro: intro.value,
    files: fileList.value,
    rosters: {
      teachers: teachers.value,
      members: members.value,
      accomp: accomp.value
    }
  }
  try {
    localStorage.setItem('instrumentFormDraft', JSON.stringify(saveData))
    ElMessage.success('表单已暂存成功')
  } catch (error) {
    console.error('暂存失败:', error)
    ElMessage.error('暂存失败，请重试')
  }
}
</script>
```

### 3. API 服务实现

```typescript
// mod1.0/src/services/api.ts

/**
 * 提交器乐报名
 * @param data 器乐报名数据
 * @returns 是否提交成功
 */
submitInstrumental: async (data: any): Promise<boolean> => {
  try {
    console.log('[submitInstrumental] 提交数据:', JSON.stringify(data, null, 2))
    const response = await post<any>(`${API_BASE}/instrumental/registrations/`, data)
    const result = response as any
    
    // 检查响应格式
    if (result.code === 200 || result.success === true) {
      return true
    }
    return false
  } catch (error: unknown) {
    console.error('Submit instrumental registration error:', error)
    
    // 详细错误信息
    if (error && typeof error === 'object' && 'response' in error) {
      const axiosError = error as any
      const response = axiosError.response
      console.error('错误状态码:', response?.status)
      console.error('错误响应数据:', response?.data)
      console.error('错误请求数据:', axiosError.config?.data)
    }
    return false
  }
}
```

---

## 错误处理

### 1. 400 Bad Request 错误

**可能原因**：
- 字段格式不正确
- 缺少必需字段
- 字段值不符合要求

**处理方式**：
```typescript
// 在 request.ts 的响应拦截器中已处理
case 400:
  const errorData = error.response.data
  const errorDetails = errorData?.detail || errorData?.errors || errorData?.message || message
  console.error('400 错误详情:', {
    status: error.response.status,
    data: errorData,
    url: error.config?.url,
    method: error.config?.method,
    requestData: error.config?.data
  })
  ElMessage.error(`请求参数错误: ${typeof errorDetails === 'object' ? JSON.stringify(errorDetails) : errorDetails}`)
  break
```

**调试方法**：
1. 查看控制台输出的错误详情
2. 检查 `requestData` 中的字段是否正确
3. 对比接口文档，确认字段名和格式

### 2. 500 Internal Server Error

**可能原因**：
- 后端处理错误
- 数据格式问题
- 数据库操作失败

**处理方式**：
```typescript
case 500:
  const errorDetail = error.response.data?.detail || error.response.data?.message || '服务器内部错误'
  ElMessage.error(`服务器错误: ${errorDetail}`)
  console.error('500 错误详情:', {
    status: error.response.status,
    data: error.response.data,
    url: error.config?.url,
    method: error.config?.method,
    params: error.config?.data
  })
  break
```

**调试方法**：
1. 检查控制台输出的完整错误信息
2. 确认提交的数据格式是否正确
3. 检查后端日志

### 3. 401 Unauthorized

**可能原因**：
- Token 过期
- 未登录

**处理方式**：
```typescript
case 401:
  ElMessage.error('登录已过期，请重新登录')
  clearUserStorage()
  window.location.href = '/login'
  break
```

### 4. 数据验证错误

**前端验证**：
- 表单字段验证（使用 `formRules`）
- 花名册数据验证（至少需要一个参赛人员）
- 人数限制验证

**后端验证**：
- 字段格式验证
- 业务规则验证

---

## 测试验证

### 1. 单元测试检查点

#### 数据转换测试
```typescript
// 测试 transformGuideTeachers
const testTeachers = [
  { name: '张老师', idNo: '110101198001011234', nation: '汉', age: 40 }
]
const result = transformGuideTeachers(testTeachers)
// 验证：
// - result[0].ethnicity === '汉族' (民族转换)
// - result[0].age === 40 (年龄保留)
// - result[0].id_card_number === '110101198001011234' (字段映射)

// 测试 transformParticipants
const testMembers = [
  { name: '学生1', idNo: '110101200001011234', nation: '汉', age: 20, majorName: '钢琴' }
]
const result2 = transformParticipants(testMembers)
// 验证：
// - result2[0].major_name === '钢琴' (优先使用 majorName)
// - result2[0].student_id 有默认值
```

#### 映射函数测试
```typescript
// 测试 mapPerformanceType
mapPerformanceType('small-ensemble') === 'small_ensemble'
mapPerformanceType('solo') === 'solo'

// 测试 mapGroupType
mapGroupType('group1') === 'amateur'
mapGroupType('group2') === 'professional'
```

### 2. 集成测试流程

1. **填写基本信息**
   - 作品名称
   - 选择表演形式
   - 填写时长
   - 选择组别

2. **填写联系信息**
   - 联系人姓名（中文）
   - 联系电话（11位）
   - 联系地址

3. **填写作品描述**
   - 输入作品简介

4. **上传作品文件**
   - 选择文件
   - 确认文件格式和大小

5. **填写花名册**
   - 添加指导教师（至少1个）
   - 添加参赛人员（至少1个）
   - 验证字段格式

6. **勾选报名须知**

7. **提交表单**
   - 检查控制台日志
   - 确认接口调用成功
   - 验证返回数据

### 3. 调试日志

在关键位置添加日志：

```typescript
// 提交前检查原始数据
console.log('[onSubmit] 原始花名册数据:', {
  teachers: teachers.value,
  members: members.value,
  teachersCount: teachers.value.length,
  membersCount: members.value.length
})

// 检查转换后数据
console.log('[onSubmit] 转换后的花名册数据:', {
  guideTeachers: guideTeachersData,
  participants: participantsData,
  guideTeachersCount: guideTeachersData.length,
  participantsCount: participantsData.length
})

// 检查完整提交数据
console.log('[onSubmit] 提交的完整数据:', JSON.stringify(apiData, null, 2))
```

---

## 完整接口数据示例

### 请求数据示例

```json
{
  "work_file": "https://example.com/path/to/your/file.mp3",
  "work_title": "贝多芬第五交响曲",
  "performance_type": "ensemble",
  "duration_minutes": 3,
  "duration_seconds": 45,
  "performer_count": 5,
  "contact_name": "张三",
  "contact_phone": "13800138000",
  "contact_address": "北京市海淀区",
  "group_type": "amateur",
  "is_original": false,
  "work_description": "经典曲目演奏",
  "status": "draft",
  "guide_teachers": [
    {
      "name": "张老师",
      "id_card_number": "110101198001011234",
      "ethnicity": "汉族",
      "age": 40,
      "gender": "female",
      "region": "北京市",
      "school_name": "北京音乐学院",
      "department": "器乐系",
      "phone": "13987654321"
    }
  ],
  "participants": [
    {
      "name": "王五",
      "id_card_number": "110101200001011234",
      "ethnicity": "汉族",
      "age": 22,
      "gender": "male",
      "region": "北京市",
      "school_name": "北京音乐学院",
      "department": "器乐系",
      "grade": "大四",
      "major_category": "艺术",
      "major_name": "钢琴表演",
      "student_id": "20180001",
      "phone": "13765432109"
    }
  ],
  "conductor": {
    "conductor_choice": "学生指挥"
  }
}
```

### 成功响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 123,
    "work_title": "贝多芬第五交响曲",
    "status": "draft"
  }
}
```

### 错误响应示例

```json
{
  "code": 400,
  "message": "请求参数错误",
  "detail": {
    "guide_teachers": ["指导教师数据格式不正确"],
    "participants": ["至少需要一个参赛人员"]
  }
}
```

---

## 关键注意事项

### 1. 字段映射
- 前端字段名与后端字段名可能不同，必须使用转换函数
- 所有字段都要有默认值，确保不会提交 `undefined` 或空字符串

### 2. 数据格式
- 民族字段：必须将"汉"转换为"汉族"
- 性别字段：必须是 `'male'` 或 `'female'`
- 年龄字段：必须是数字类型

### 3. 必填字段
- `participants` 数组至少需要有一个元素
- `work_title`、`contact_name`、`contact_phone` 等基础字段必填

### 4. 文件处理
- 如果文件未上传，使用默认URL
- 文件URL需要先上传到服务器获取

### 5. 数据同步
- 使用 `TeacherBlock` 和 `MemberBlock` 组件确保数据正确同步
- 注意 `isSyncing` 标志的使用，防止循环更新

---

## 总结

器乐报名接口的完整实现包括：

1. **表单结构**：6个主要部分，涵盖所有必需信息
2. **字段映射**：完整的前后端字段映射表
3. **数据转换**：标准化的转换函数，处理所有特殊情况
4. **接口调用**：完整的提交流程，包含验证和错误处理
5. **错误处理**：详细的错误处理和调试方法

按照本文档的步骤，可以确保接口对接的完整性和可靠性。

