# 用户端首页报名记录字段映射文档

## 1. localStorage 存储键映射

在 `loadRegistrationRecords()` 函数中，定义了存储键到类别键的映射：

```typescript
const keyMap: Record<string, string> = {
  'vocalFormDraft': 'vocal',                    // 声乐报名
  'instrumentFormDraft': 'instrumental',       // 器乐报名
  'danceFormDraft': 'dance',                   // 舞蹈报名
  'operaFormDraft': 'opera',                   // 戏曲报名
  'recitationFormDraft': 'recitation',         // 朗诵报名
  'calligraphyFormDraft': 'calligraphy',       // 书法作品
  'paintingFormDraft': 'painting',            // 绘画作品
  'designFormDraft': 'design',                // 设计作品
  'photographyFormDraft': 'photography',      // 摄影作品
  'microfilmFormDraft': 'microfilm',          // 微电影作品
  'artPracticeFormDraft': 'artPractice',      // 艺术实践工作坊
  'aestheticInnovationFormDraft': 'aestheticInnovation'  // 美育改革创新案例
}
```

## 2. 类别名称映射

在 `getCategoryName()` 函数中，定义了类别键到中文名称的映射：

```typescript
const names: Record<string, string> = {
  vocal: '声乐报名',
  instrumental: '器乐报名',
  dance: '舞蹈报名',
  opera: '戏曲报名',
  recitation: '朗诵报名',
  calligraphy: '书法作品',
  painting: '绘画作品',
  design: '设计作品',
  photography: '摄影作品',
  microfilm: '微电影作品',
  artPractice: '艺术实践工作坊',
  aestheticInnovation: '美育改革创新案例'
}
```

## 3. 作品名称提取映射

在 `extractWorkName()` 函数中，根据类别从不同字段提取作品名称：

| 类别 | 优先字段 | 备选字段 |
|------|---------|---------|
| 声乐报名 (vocal) | `base.song1` | `base.workName` → `base.title` |
| 其他演奏类 | `base.workName` | `base.title` |
| 艺术实践工作坊 | `base.projectName` | - |
| 美育改革创新案例 | `base.caseName` | - |
| 默认 | - | '未命名作品' |

## 4. 列表显示字段映射

在表格中显示的字段来自 `RegistrationRecord` 接口：

```typescript
interface RegistrationRecord {
  index: number              // 序号（自动生成）
  category: string          // 类别（通过 getCategoryName 映射）
  categoryKey: string        // 类别键（vocal, instrumental 等）
  workName: string           // 作品名称（通过 extractWorkName 提取）
  submitTime: string         // 提交时间（从 parsed.submitTime 或当前时间）
  status: string            // 状态（从 parsed.status 或 '未审核'）
  storageKey: string         // localStorage 键名
  data: Record<string, unknown>  // 原始数据
}
```

## 5. 详情数据提取映射 (`extractDetailFromData`)

### 5.1 数据源结构

从 `row.data` 中提取的数据结构：

```typescript
{
  base: Record<string, unknown>,      // 基础表单字段
  rosters: Record<string, unknown[]>,  // 花名册数据
  files: Array<FileItem>,              // 文件列表
  intro: string,                      // 简介
  authors: unknown[],                  // 作者列表（作品类）
  authorIntro: string,                 // 作者简介
  creationIntro: string,               // 创作说明
  projectIntro: string,                // 项目简介
  designThoughts: string,             // 设计思路
  exhibitionDesign: string            // 展览设计
}
```

### 5.2 基本信息字段映射

| 显示字段 | 数据源 | 说明 |
|---------|--------|------|
| `category` | `row.category` | 类别名称 |
| `workName` | `row.workName` | 作品名称 |
| `submitTime` | `row.submitTime` | 提交时间 |
| `status` | `row.status` | 审核状态 |

### 5.3 演奏类字段映射（声乐、器乐、舞蹈、戏曲、朗诵）

| 显示字段 | 数据源 | 说明 |
|---------|--------|------|
| `performanceType` | `base.performanceType` | 表演形式 |
| `minutes` | `base.minutes` | 作品时长（分钟） |
| `seconds` | `base.seconds` | 作品时长（秒） |
| `isOriginal` | `base.isOriginal` | 是否原创 |
| `group` | `base.group` | 组别 |
| `song1` | `base.song1` | 曲目1 |
| `song2` | `base.song2` | 曲目2 |
| `song1HasChinese` | `base.song1HasChinese` | 曲目1是否中文作品 |
| `song2HasChinese` | `base.song2HasChinese` | 曲目2是否中文作品 |
| `song1IsOriginal` | `base.song1IsOriginal` | 曲目1是否原创 |
| `song2IsOriginal` | `base.song2IsOriginal` | 曲目2是否原创 |
| `chorusCount` | `base.chorusCount` | 合唱人数 |
| `pianoAccompanist` | `base.pianoAccompanist` | 钢琴伴奏（teacher/student） |
| `leader` | `base.leader` | 领队 |
| `tutor` | `base.tutor` | 指导教师 |
| `contact` | `base.contact` | 联系人 |
| `phone` | `base.phone` | 联系电话 |
| `address` | `base.address` | 地址 |

### 5.4 作品类字段映射（书法、绘画、设计、摄影）

| 显示字段 | 数据源 | 说明 |
|---------|--------|------|
| `workNameField` | `base.title` 或 `base.workName` | 作品名称 |
| `tutorField` | `base.tutor` | 指导教师 |
| `length` | `base.length` | 作品长度（cm） |
| `width` | `base.width` | 作品宽度（cm） |
| `createAt` | `base.createAt` | 创作时间 |
| `formType` | `base.formType` | 作品形式 |
| `group` | `base.group` | 组别 |
| `authorIntro` | `data.authorIntro` | 作者简介 |
| `creationIntro` | `data.creationIntro` | 创作说明 |

### 5.5 微电影作品字段映射

| 显示字段 | 数据源 | 说明 |
|---------|--------|------|
| `workNameField` | `base.title` 或 `base.workName` | 作品名称 |
| `group` | `base.group` | 组别 |
| `videoMinutes` | `base.videoMinutes` | 作品时长（分钟） |
| `videoSeconds` | `base.videoSeconds` | 作品时长（秒） |
| `createAt` | `base.createAt` | 创作时间 |
| `tutor1` | `base.tutor1` | 指导教师1 |
| `tutor2` | `base.tutor2` | 指导教师2 |
| `tutor3` | `base.tutor3` | 指导教师3 |
| `authorIntro` | `data.authorIntro` | 作者简介 |
| `creationIntro` | `data.creationIntro` | 创作说明 |

### 5.6 艺术实践工作坊字段映射

| 显示字段 | 数据源 | 说明 |
|---------|--------|------|
| `projectName` | `base.projectName` | 项目名称 |
| `contactPosition` | `base.contactPosition` | 联系人职务 |
| `contact` | `base.contact` | 联系人 |
| `contactUnit` | `base.contactUnit` | 联系单位 |
| `phone` | `base.phone` | 联系电话 |
| `email` | `base.email` | 邮箱 |
| `address` | `base.address` | 地址 |
| `categoryField` | `base.category` | 类别 |
| `projectIntro` | `data.projectIntro` | 项目简介 |
| `designThoughts` | `data.designThoughts` | 设计思路 |
| `exhibitionDesign` | `data.exhibitionDesign` | 展览设计 |

### 5.7 美育改革创新案例字段映射

| 显示字段 | 数据源 | 说明 |
|---------|--------|------|
| `caseName` | `base.caseName` | 案例名称 |
| `caseCode` | `base.caseCode` | 案例代码 |
| `leaderName` | `base.leaderName` | 负责人姓名 |
| `leaderTitle` | `base.leaderTitle` | 负责人职称 |
| `submitUnit` | `base.submitUnit` | 报送单位 |
| `leaderUnit` | `base.leaderUnit` | 负责人单位 |
| `leaderPhone` | `base.leaderPhone` | 负责人电话 |
| `categoryField` | `base.category` | 类别（选题方向） |

### 5.8 花名册数量字段映射

| 显示字段 | 数据源 | 说明 |
|---------|--------|------|
| `teachersCount` | `rosters.teachers.length` | 教师数量 |
| `membersCount` | `rosters.members.length` | 成员数量 |
| `accompCount` | `rosters.accomp.length` | 伴奏数量 |
| `studentAccompCount` | `rosters.studentAccomp.length` | 学生伴奏数量 |
| `teacherAccompCount` | `rosters.teacherAccomp.length` | 教师伴奏数量 |
| `participantsCount` | `rosters.participants.length` | 参与人员数量 |
| `authorsCount` | `authors.length` | 作者数量（作品类） |

### 5.9 文件列表字段映射

| 显示字段 | 数据源 | 说明 |
|---------|--------|------|
| `files[].name` | `files[].name` | 文件名 |
| `files[].size` | `files[].size` | 文件大小（字节） |
| `files[].type` | `files[].type` | 文件类型 |

### 5.10 简介字段映射

简介字段按优先级提取：

```typescript
intro: intro || creationIntro || projectIntro || authorIntro || designThoughts || exhibitionDesign
```

优先级顺序：
1. `data.intro` - 通用简介
2. `data.creationIntro` - 创作说明
3. `data.projectIntro` - 项目简介
4. `data.authorIntro` - 作者简介
5. `data.designThoughts` - 设计思路
6. `data.exhibitionDesign` - 展览设计

## 6. 数据加载流程

1. **从 localStorage 读取**：根据 `keyMap` 遍历所有存储键
2. **解析 JSON**：将存储的字符串解析为对象
3. **构建记录**：
   - `category`: 通过 `getCategoryName(categoryKey)` 获取中文名称
   - `workName`: 通过 `extractWorkName(parsed, categoryKey)` 提取作品名称
   - `submitTime`: 从 `parsed.submitTime` 或使用当前时间
   - `status`: 从 `parsed.status` 或默认为 '未审核'
4. **存储到响应式数组**：`registrationRecords.value` 和 `allRecords.value`

## 7. 详情查看流程

1. **点击"查看"按钮**：调用 `viewDetail(row)`
2. **提取详情数据**：调用 `extractDetailFromData(row)` 提取所有字段
3. **打开对话框**：设置 `currentDetail.value` 并显示 `detailDialogVisible = true`
4. **条件渲染**：根据 `currentDetail.category` 显示不同类别的详情模板

## 8. 注意事项

1. **字段缺失处理**：所有字段都有默认值或空值处理，避免显示 `undefined`
2. **类型转换**：使用 `String()`, `Number()`, `Array.isArray()` 确保类型安全
3. **条件显示**：模板中使用 `v-if` 条件渲染，只显示存在的字段
4. **数据源统一**：所有数据都来自 `localStorage`，格式为 `{ base, rosters, files, intro, ... }`

## 9. 相关文件

- **主文件**：`mod1.0/src/views/user/first.vue`
- **关键函数**：
  - `loadRegistrationRecords()`: 加载报名记录
  - `getCategoryName()`: 获取类别名称
  - `extractWorkName()`: 提取作品名称
  - `extractDetailFromData()`: 提取详情数据
  - `viewDetail()`: 查看详情

